<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador Pro: √Åtomos e Iones Variados</title>
    <style>
        :root {
            --primary: #4f46e5; --secondary: #312e81; --accent: #f59e0b; --bg: #f8fafc;
            --correct-bg: #dcfce7; --correct-txt: #166534; --wrong-bg: #fee2e2; --wrong-txt: #991b1b;
        }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background-color: var(--bg); color: #334155; margin: 0; padding: 20px; }
        .container { max-width: 1150px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: var(--secondary); margin: 0; }
        .subtitle { text-align: center; color: #64748b; font-size: 0.9em; margin-bottom: 20px; }
        
        /* Chuleta */
        .summary-box { background: #e0e7ff; border-left: 5px solid var(--primary); padding: 15px; border-radius: 6px; margin-bottom: 25px; display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; }
        .rule { background: white; padding: 5px 12px; border-radius: 15px; font-weight: 600; color: var(--secondary); font-size: 0.85em; }

        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th { background-color: var(--primary); color: white; padding: 10px; border: 1px solid var(--primary); font-size: 0.85em; }
        td { border: 1px solid #cbd5e1; padding: 8px; text-align: center; height: 42px; }
        
        input { width: 55px; padding: 5px; text-align: center; font-size: 1rem; border: 2px solid #cbd5e1; border-radius: 6px; font-weight: bold; }
        input.correct { background: var(--correct-bg); border-color: var(--correct-txt); color: var(--correct-txt); }
        input.wrong { background: var(--wrong-bg); border-color: var(--wrong-txt); color: var(--wrong-txt); }

        .controls { display: flex; justify-content: center; gap: 10px; margin: 20px 0; }
        button { padding: 10px 18px; font-size: 0.9rem; cursor: pointer; border: none; border-radius: 6px; font-weight: 600; color: white; transition: 0.2s; }
        .btn-check { background-color: #10b981; } .btn-new { background-color: var(--primary); } .btn-pdf { background-color: #475569; flex: 1; }

        #print-section { display: none; }
        @media print {
            body { background: white; padding: 0; } .no-print { display: none !important; } #print-section { display: block; }
            .print-summary { border: 1px solid #000; padding: 10px; margin-bottom: 15px; display: flex; justify-content: space-around; font-weight: bold; background: #f8f8f8 !important; -webkit-print-color-adjust: exact; }
            th { background: #eee !important; color: black; } .page-break { page-break-before: always; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="no-print">
        <h1>‚öõÔ∏è Entrenador At√≥mico "Mix"</h1>
        <div class="subtitle">Ejercicios combinados de deducci√≥n (Z, p‚Å∫, e‚Åª y Carga)</div>
        
        <div class="summary-box">
            <span class="rule">A = Z + n‚Å∞</span> 
            <span class="rule">Z = p‚Å∫</span> 
            <span class="rule">Carga = p‚Å∫ - e‚Åª</span>
        </div>

        <div style="overflow-x:auto">
            <table>
                <thead>
                    <tr><th>Nombre</th><th>S√≠mbolo</th><th>Z</th><th>A</th><th>p‚Å∫</th><th>n‚Å∞</th><th>e‚Åª</th><th>Carga</th></tr>
                </thead>
                <tbody id="interactive-body"></tbody>
            </table>
        </div>

        <div id="feedback" style="text-align:center; font-weight:bold; height:24px; margin:10px;"></div>
        
        <div class="controls">
            <button class="btn-check" onclick="checkAnswer()">‚úÖ Comprobar</button>
            <button class="btn-new" onclick="newExercise()">üîÑ Siguiente</button>
        </div>

        <div style="display:flex; gap:10px; margin-top:20px; border-top:2px dashed #ccc; padding-top:20px;">
            <button class="btn-pdf" onclick="generatePDF(10)">üìÑ PDF 10 Ejercicios (Mix)</button>
            <button class="btn-pdf" onclick="generatePDF(20)">üìÑ PDF 20 Ejercicios (Mix)</button>
        </div>
    </div>

    <div id="print-section">
        <div style="display:flex; justify-content:space-between; border-bottom:1px solid #000;">
            <span>Nombre: _________________________________________</span><span>F√≠sica y Qu√≠mica 3¬∫ ESO</span>
        </div>
        <h1>Ficha: Estructura At√≥mica e Iones (Combinados)</h1>
        <div class="print-summary">
            <span>A = Z + n‚Å∞</span><span>Z = p‚Å∫</span><span>Carga = p‚Å∫ - e‚Åª</span>
        </div>
        <table id="worksheet-table">
            <thead><tr><th>Nombre</th><th>S√≠mbolo</th><th>Z</th><th>A</th><th>p‚Å∫</th><th>n‚Å∞</th><th>e‚Åª</th><th>Carga</th></tr></thead>
            <tbody></tbody>
        </table>
        <div class="page-break"></div>
        <h1>Solucionario</h1>
        <table id="solution-table">
            <thead><tr><th>Nombre</th><th>S√≠mbolo</th><th>Z</th><th>A</th><th>p‚Å∫</th><th>n‚Å∞</th><th>e‚Åª</th><th>Carga</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<script>
    const db = {
        aniones: [
            {z:7, s:"N", n:"Nitr√≥geno", a:14, c:-3}, {z:15, s:"P", n:"F√≥sforo", a:31, c:-3},
            {z:8, s:"O", n:"Ox√≠geno", a:16, c:-2}, {z:16, s:"S", n:"Azufre", a:32, c:-2},
            {z:9, s:"F", n:"Fl√∫or", a:19, c:-1}, {z:17, s:"Cl", n:"Cloro", a:35, c:-1}
        ],
        cationes: [
            {z:11, s:"Na", n:"Sodio", a:23, c:1}, {z:19, s:"K", n:"Potasio", a:39, c:1}, {z:20, s:"Ca", n:"Calcio", a:40, c:2},
            {z:26, s:"Fe", n:"Hierro", a:56, c:2}, {z:29, s:"Cu", n:"Cobre", a:64, c:2}, {z:13, s:"Al", n:"Aluminio", a:27, c:3},
            {z:30, s:"Zn", n:"Cinc", a:65, c:2}, {z:47, s:"Ag", n:"Plata", a:108, c:1}, {z:79, s:"Au", n:"Oro", a:197, c:3}
        ],
        neutros: [
            {z:2, s:"He", n:"Helio", a:4}, {z:6, s:"C", n:"Carbono", a:12}, {z:10, s:"Ne", n:"Ne√≥n", a:20},
            {z:18, s:"Ar", n:"Arg√≥n", a:40}, {z:25, s:"Mn", n:"Manganeso", a:55}, {z:82, s:"Pb", n:"Plomo", a:207}
        ]
    };

    function getSymbolDisp(s, c) {
        if (c === 0) return s;
        let abs = Math.abs(c);
        return `${s}<sup>${abs === 1 ? "" : abs}${c > 0 ? "+" : "-"}</sup>`;
    }

    function createSet(total) {
        let result = [];
        let counts = total === 1 ? { a: Math.random()<0.3?1:0, c: Math.random()<0.3?1:0, n: 0 } : { a: Math.round(total*0.3), c: Math.round(total*0.3) };
        if (total === 1 && counts.a === 0 && counts.c === 0) counts.n = 1;
        else if (total > 1) counts.n = total - counts.a - counts.c;

        ['aniones', 'cationes', 'neutros'].forEach(cat => {
            let key = cat[0];
            let list = [...db[cat]].sort(() => Math.random() - 0.5);
            for(let i=0; i < (counts[key]||0); i++) {
                let el = list[i % list.length];
                let charge = cat === 'neutros' ? 0 : el.c;
                result.push({ name: el.n, symbol: el.s, symbolDisp: getSymbolDisp(el.s, charge), z: el.z, a: el.a, p: el.z, n: el.a - el.z, e: el.z - charge, c: charge });
            }
        });
        return result.sort(() => Math.random() - 0.5);
    }

    function createRow(data, isApp, isSol) {
        // ESTRATEGIAS VARIADAS
        const strategies = [
            ['e', 'a', 'n'], // Mix 1: Tienen e-, deben hallar p+ y Z.
            ['z', 'n', 'c'], // Mix 2: Tienen Z, deben hallar e-.
            ['p', 'e', 'a'], // Mix 3: Tienen p+ y e-, deben hallar carga y Z.
            ['z', 'a', 'e']  // Mix 4: Tienen Z y e-, deben hallar carga y n.
        ];
        const visiblePool = strategies[Math.floor(Math.random() * strategies.length)];
        
        let html = "<tr>";
        const cols = [
            {k:'name', v: data.name}, {k:'symbol', v: data.symbolDisp},
            {k:'z', v: data.z}, {k:'a', v: data.a}, {k:'p', v: data.p}, {k:'n', v: data.n}, {k:'e', v: data.e}, {k:'c', v: data.c}
        ];

        cols.forEach(col => {
            let isInfo = ['name', 'symbol'].includes(col.k);
            let isVisible = isInfo || visiblePool.includes(col.k);

            // REGLAS DE EXCLUSI√ìN PARA VARIAR:
            // 1. Si damos electrones y carga, ocultamos Z y p+.
            if (visiblePool.includes('e') && (col.k === 'p' || col.k === 'z')) isVisible = false;
            // 2. Si damos Z o protones, ocultamos electrones (a menos que la estrategia lo pida).
            if ((visiblePool.includes('z') || visiblePool.includes('p')) && col.k === 'e' && !visiblePool.includes('e')) isVisible = false;
            // 3. Iones: La carga siempre se oculta para que se calcule.
            if (col.k === 'c' && data.c !== 0) isVisible = false;

            if (isApp) {
                if (isVisible) html += `<td>${col.v}</td>`;
                else html += `<td><input type="text" data-correct="${col.v}"></td>`;
            } else {
                if (isSol) html += `<td>${col.v}</td>`;
                else html += `<td>${isVisible ? col.v : ""}</td>`;
            }
        });
        return html + "</tr>";
    }

    function newExercise() {
        document.getElementById('feedback').innerText = "";
        const data = createSet(1)[0];
        document.getElementById('interactive-body').innerHTML = createRow(data, true, false);
    }

    function checkAnswer() {
        let err = 0;
        document.querySelectorAll('#interactive-body input').forEach(i => {
            if (i.value.trim() == "" || parseInt(i.value) != parseInt(i.dataset.correct)) {
                i.classList.add('wrong'); i.classList.remove('correct'); err++;
            } else {
                i.classList.add('correct'); i.classList.remove('wrong');
            }
        });
        document.getElementById('feedback').innerText = err === 0 ? "¬°Excelente! Nivel de experto." : "Hay errores en el c√°lculo.";
    }

    function generatePDF(n) {
        const data = createSet(n);
        const ws = document.querySelector('#worksheet-table tbody');
        const sol = document.querySelector('#solution-table tbody');
        ws.innerHTML = sol.innerHTML = "";
        data.forEach(d => {
            ws.innerHTML += createRow(d, false, false);
            sol.innerHTML += createRow(d, false, true);
        });
        window.print();
    }

    newExercise();
</script>
</body>
</html>
